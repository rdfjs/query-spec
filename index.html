<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>RDF/JS: Query specification</title>
  <script src="https://www.w3.org/Tools/respec/respec-w3c-common" class="remove"></script>
  <script class="remove">
    var respecConfig = {
      specStatus: "CG-DRAFT",
      shortName: "rdfjs",
      subtitle: "RDF/JS: Query specification",
      processVersion: 2020,
      edDraftURI: "https://github.com/rdfjs/query-spec/",
      issueBase: "https://github.com/rdfjs/query-spec/issues/",
      githubAPI: "https://api.github.com/repos/rdfjs/query-spec",
      // TODO: testSuiteURIkey: "",
      editors: [
          {
            name: "Ruben Taelman",
            url: "https://www.rubensworks.net/#me",
            company: "Ghent University – imec",
            companyURL: "http://idlab.ugent.be/",
            w3cid: 84199
          }
      ],
      authors:  [
          {
            name: "Ruben Taelman",
            url: "https://www.rubensworks.net/#me",
            company: "Ghent University – imec",
            companyURL: "http://idlab.ugent.be/",
            w3cid: 84199
          }
      ],
      bugTracker:             {
        open: "https://github.com/rdfjs/query-spec/issues?utf8=%E2%9C%93&q=is%3Aissue%20is%3Aopen%20",
        new:  "https://github.com/rdfjs/query-spec/issues/new"
      },
      otherLinks: [{
        key: "Version control",
        data: [{
          value: "Github Repository",
          href: "https://github.com/rdfjs/query-spec"
        }]
      }],
      wg: "RDF JavaScript Libraries Community Group",
      wgURI: "https://www.w3.org/community/rdfjs/",
      wgPublicList: "public-rdfjs",
      maxTocLevel: 2
    };
  </script>
</head>
<body>
<section id="abstract">
  <h2>Abstract</h2>
  <p>
    The scope of this specification is to provide a way to query over quads, as defined in the <a href="http://rdf.js.org/data-model-spec/#quad-interface">RDF/JS: Data model specification</a>.
    Similar to the <a href="http://rdf.js.org/data-model-spec/">RDF/JS: Data model specification</a>, this is a low-level specification that provides only essential methods for working across query engine component.
    High-level querying interfaces can and should be using libraries that implement this interface.
  </p>
  <p>The specification itself consists of a core-part that is the base for all other functions defined.</p>
  <p>Low-level methods are using explicit parameters that cannot be omitted.</p>
  <p>Additional high-level interfaces are outside of the scope of this specification and should be defined elsewhere.</p>
</section>

<section id="sotd">
  <p>
    This document provides a specification of an interface for RDF query engines in a JavaScript environment.
	The task force which defines this interface was formed by RDF JavaScript library developers with the wish to make existing
    and future libraries interoperable. This definition strives to provide the minimal necessary
    interface to enable interoperability of RDF querying libraries.
  </p>
  <p>
    <strong>Currently, this specification only provides interfaces that enable filtering quads based on expressions.</strong>
    Additional interfaces for more general querying support will be defined in the future.
  </p>
</section>

<section>
  <h2>Design elements and principles</h2>
  <ul>
    <li><em>All <a href="http://rdf.js.org/data-model-spec/#design-elements-and-principles">design elements and principles from the RDF/JS data model specification</a> apply here as well.</em></li>
    <li>Interfaces do not conflict with other RDF/JS interfaces, and users and implementers of purely other RDF/JS interfaces should not be aware of the interfaces in this specification if they are not needed.</li>
    <li>Data interfaces should not contain methods, as to enable straightforward transmission over low-level communication protocols such as Web Assembly.</li>
    <li>To enable querying over large graphs, interfaces should handle quads in a streaming manner, such as the <a href="https://rdf.js.org/stream-spec/">RDF/JS stream interfaces</a>.</li>
  </ul>
</section>

<section>
  <h2>Filter expression interfaces</h2>
  
  This section introduces interfaces that enable quad sources to be filtered based on a declarative expression.
  
  <section>
    <h2>Goals</h2>
    <ul>
      <li>Query engines MUST be able to push down filters into sources.</li>
      <li>Query engines MUST be able to detect what expressions are supported by sources.</li>
      <li>Query engines MUST be able to obtain the estimated cardinality of any supported expression.</li>
    </ul>
  </section>

  <section data-dfn-for="FilterableSource">
    <h3><dfn>FilterableSource</dfn> interface</h3>

    <pre class="idl">
    interface FilterableSource {
      FilterResult matchExpression (
        optional Term? subject,
        optional Term? predicate,
        optional Term? obj,
        optional Term? graph,
        optional Expression? expression
      );
    };
    </pre>
    
    <p>
      A <code>FilterableSource</code> is an object that produces a <code>FilterableSourceResult</code> that can emit quads.
      The emitted quads can be directly contained in this <code>FilterableSource</code> object, or they can be generated on the fly.
    </p>
    <p>
      <code>FilterableSource</code> is not necessarily an extension of the <a href="https://rdf.js.org/stream-spec/#source-interface">RDF/JS Source interface</a>, but implementers MAY decide to implement both at the same time.
    </p>
    <p>
      <dfn>matchExpression()</dfn> Returns a <code>FilterableSourceResult</code> that contains a quad stream that processes all quads matching the quad pattern and the expression.
    </p>
    <p>
      When a <code>Term</code> parameter is defined, it must match each produced quad, according to the <a href="http://rdf.js.org/data-model-spec/#quad-interface"><code>Quad.equals</code></a> semantics. When it is undefined, it acts as a wildcard, and can match with any <code>Term</code>.
    </p>
    <p class="note">
      When matching with <code>graph</code> set to <code>undefined</code> or <code>null</code>
      it MUST match all the graphs (sometimes called <em>the union graph</em>). To match only <em>the default graph</em>
      set <code>graph</code> to a <code>DefaultGraph</code>
    </p>
    <p>
      When an <code>Expression</code> parameter is defined, the complete quad stream is filtered according to this expression.
      When it is undefined, no filter is applied, and the semantics are identical to that of <a href="https://rdf.js.org/stream-spec/#source-interface">Source.match</a>.
    </p>
  </section>
  
  <section data-dfn-for="FilterResult">
    <h3><dfn>FilterResult</dfn> interface</h3>

    <pre class="idl">
    interface FilterResult {
      Stream quads();
      Promise&lt;QueryResultMetadata&gt; metadata(optional QueryResultMetadataOptions? options);
      Promise&lt;boolean&gt; isSupported();
    };
    </pre>
    
    <p>
      A <code>FilterResult</code> is an object that represents the result of a filter expression of <code>FilterableSource</code> for a given quad pattern and expression.
      It MAY create results lazily after one of its methods is invoked.
    </p>
    <p>
      <dfn>quads()</dfn> Returns a <a href="https://rdf.js.org/stream-spec/#stream-interface"><code>Stream<Quad></code></a> containing all the quads that matched the given quad pattern and expression.
    </p>
    <p>
      <dfn>metadata()</dfn> Asynchronously returns a <code>QueryResultMetadata</code>, that contains the metadata of the current result.
    </p>
    <p>
      <dfn>isSupported()</dfn> Asynchronously returns a boolean indicating if the requested expression is supported by the <code>FilterableSource</code>.
      If it returns <code>true</code>, <code>quads()</code> and <code>metadata()</code> MAY produce a valid result.
      If it returns <code>false</code>, <code>quads()</code> MUST return a stream emitting an error, and <code>metadata()</code> MUST reject.
    </p>
  </section>

</section>

</body>
</html>
